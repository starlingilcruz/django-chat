files:
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/django.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/log/django/*.log

  "/opt/python/etc/daphne.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      [program:daphne]
      command=/var/app/venv/staging-LQM1lest/bin/daphne -b 0.0.0.0 -p 8000 openchat.asgi:application
      directory=/var/app/current
      user=webapp
      autostart=true
      autorestart=true
      stdout_logfile=/var/log/django/daphne.log
      stderr_logfile=/var/log/django/daphne.err.log

container_commands:
  01_create_log_dir:
    command: "mkdir -p /var/log/django && chown webapp:webapp /var/log/django"
  02_start_daphne:
    command: "sudo supervisorctl reread && sudo supervisorctl update && sudo supervisorctl restart daphne"
